<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - Capybara Messenger</title>
  <link href="https://fonts.googleapis.com/css2?family=Konkhmer+Sleokchher&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Roboto', sans-serif;
      background-color: #306748;
      overflow: hidden;
    }
    
    .container {
      width: 1440px;
      height: 1024px;
      position: relative;
      margin: 0 auto;
      background: #306748;
      overflow: hidden;
    }
    
    .nav-button {
      width: 344px;
      height: 85px;
      background: #E39451;
      border-radius: 35px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    
    .nav-button:hover {
      background: #f0a05a;
    }
    
    .nav-button-text {
      color: white;
      font-size: 48px;
      font-family: 'Konkhmer Sleokchher', cursive;
      font-weight: 400;
      text-align: center;
    }
    
    .general-button {
      left: 38px;
      top: 127px;
      position: absolute;
    }
    
    .users-button {
      left: 38px;
      top: 234px;
      position: absolute;
    }
    
    .filter-button {
      left: 38px;
      top: 341px;
      position: absolute;
    }
    
    .exit-button {
      width: 228px;
      height: 85px;
      left: 38px;
      top: 908px;
      position: absolute;
      background: #E39451;
      border-radius: 35px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.3s;
    }
    
    .exit-button:hover {
      background: #f0a05a;
    }
    
    .exit-text {
      width: 100%;
      height: 70px;
      color: white;
      font-size: 48px;
      font-family: 'Konkhmer Sleokchher', cursive;
      font-weight: 400;
      text-align: center;
      line-height: 85px;
    }
    
    .content-area {
      width: 1011px;
      height: 700px;
      left: 414px;
      top: 127px;
      position: absolute;
      background: #F0FAEF;
      border-radius: 70px;
      overflow: hidden;
    }
    
    .title {
      width: 455px;
      height: 112px;
      left: 28px;
      top: 12px;
      position: absolute;
      text-align: center;
      color: white;
      font-size: 48px;
      font-family: 'Konkhmer Sleokchher', cursive;
      font-weight: 400;
    }
    
    .profile-pic {
      width: 80px;
      height: 80px;
      left: 10px;
      top: 12px;
      position: absolute;
      border-radius: 172px;
      object-fit: cover;
    }
    
    .tabs-container {
      width: 100%;
      height: 55px;
      position: absolute;
      top: 23px;
      display: flex;
      justify-content: space-around;
    }
    
    .tab-divider {
      width: 1011px;
      height: 1px;
      left: 0;
      top: 95px;
      position: absolute;
      background: black;
    }
    
    .tab {
      color: black;
      font-size: 16px;
      font-family: 'Roboto', sans-serif;
      font-weight: 400;
      line-height: 24px;
      letter-spacing: 0.5px;
      cursor: pointer;
      padding: 4px 12px;
      transition: all 0.3s;
    }
    
    .tab:hover {
      background-color: rgba(0,0,0,0.05);
      border-radius: 4px;
    }
    
    .tab.active {
      font-weight: 500;
      color: #306748;
      border-bottom: 2px solid #306748;
    }
    
    .tab-content {
      display: none;
      padding: 20px;
      margin-top: 100px;
      height: calc(100% - 140px);
      overflow-y: auto;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* Add these new styles for search bar */
    .admin-search-container {
      width: 800px;
      /* height: 60px; */
      position: absolute;
      left: 500px; /* Совпадает с left у content-area */
      top: 30px; /* Немного выше content-area */
      display: flex;
      align-items: center; /* Убираем justify-content: center */
      z-index: 10;
    }
    
    .admin-search-bar {
      width: 970px; /* Увеличиваем с 400px до почти ширины контейнера */
      height: 60px;
      background-color: #FDD367;
      border-radius: 25px;
      color: #7E453D;
      font-size: 32px;
      font-weight: 400;
      border: none;
      padding: 0 20px;
      text-align: center;
      font-family: 'Konkhmer Sleokchher', cursive;
      outline: none;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .admin-search-bar::placeholder {
      color: #7E453D;
    }
    
    .filter-dropdown {
      position: relative;
    }
    
    .admin-filter-button {
      width: 200px;
      height: 60px;
      background-color: #FDD367;
      border-radius: 25px;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #7E453D;
      font-size: 26px;
      font-weight: 400;
      border: none;
      font-family: 'Konkhmer Sleokchher', cursive;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .filter-dropdown-content {
      display: none;
      position: absolute;
      background-color: white;
      min-width: 200px;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
      z-index: 1;
      border-radius: 15px;
      overflow: hidden;
    }
    
    .filter-dropdown-content.show {
      display: block;
    }
    
    .filter-option {
      color: #306748;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
      cursor: pointer;
      font-family: 'Konkhmer Sleokchher', cursive;
      font-size: 18px;
      border: none;
      background: white;
      width: 100%;
      text-align: left;
    }
    
    .filter-option:hover {
      background-color: #f1f1f1;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="container">
    <!-- Header and profile -->
    <div class="title">Admin panel</div>
    <img class="profile-pic" src="/static/img/image 86.png" alt="Profile" />
    
    <!-- Add search bar above content-area -->
    <div class="admin-search-container">
      <input type="text" class="admin-search-bar" placeholder="Search">
    </div>
    
    <!-- Navigation buttons -->
    <div class="nav-button general-button" onclick="switchTab('general')">
      <div class="nav-button-text">General</div>
    </div>
    
    <div class="nav-button users-button" onclick="switchTab('users')">
      <div class="nav-button-text">Users</div>
    </div>
    
    <div class="nav-button filter-button" onclick="switchTab('filter')">
      <div class="nav-button-text">Filter</div>
    </div>
    
    <!-- Exit button -->
    <button class="exit-btn" id="adminExitBtn"
    style="width: 344px; height: 85px; left: 38px; top: 447px; position: absolute;
    background: #E39451; border-radius: 35px; border: none; color: white; font-size: 48px;
    font-family: 'Konkhmer Sleokchher', cursive; font-weight: 400; text-align: center;
    padding-left: 0; cursor: pointer; z-index: 10;
    transition: transform 0.15s cubic-bezier(.4,0,.2,1), box-shadow 0.15s;">
  Exit
</button>
    
    <!-- Main content area -->
    <div class="content-area">
      <!-- Tabs -->
      <div class="tabs-container">
        <div class="tab" data-tab="users" onclick="activateTabContent('users')">USERS</div>
        <div class="tab" data-tab="online" onclick="activateTabContent('online')">ONLINE</div>
        <div class="tab" data-tab="friends" onclick="activateTabContent('friends')">FRIENDS</div>
        <div class="tab" data-tab="groups" onclick="activateTabContent('groups')">GROUPS</div>
        <div class="tab" data-tab="messages" onclick="activateTabContent('messages')">MESSAGES</div>
        <div class="tab" data-tab="attachments" onclick="activateTabContent('attachments')">ATTACHMENTS</div>
        <div class="tab" data-tab="blocked" onclick="activateTabContent('blocked')">BLOCKED USERS</div>
      </div>
      
      <div class="tab-divider"></div>
      
      <!-- Tab content areas -->
      <div id="users-content" class="tab-content">
        <h2>Users Management</h2>
        <p>View and manage all registered users.</p>
        <table style="width:100%; border-collapse: collapse;">
          <tr style="background-color: #e0e0e0;">
            <th style="padding: 8px; text-align: left;">User ID</th>
            <th style="padding: 8px; text-align: left;">Username</th>
            <th style="padding: 8px; text-align: left;">Email</th>
            <th style="padding: 8px; text-align: left;">Registered</th>
            <th style="padding: 8px; text-align: left;">Actions</th>
          </tr>
          <tr>
            <td style="padding: 8px; border-bottom: 1px solid #ddd;">1</td>
            <td style="padding: 8px; border-bottom: 1px solid #ddd;">johndoe</td>
            <td style="padding: 8px; border-bottom: 1px solid #ddd;">john@example.com</td>
            <td style="padding: 8px; border-bottom: 1px solid #ddd;">2023-04-15</td>
            <td style="padding: 8px; border-bottom: 1px solid #ddd;">
              <button style="background: #306748; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">Edit</button>
              <button style="background: #E39451; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">Delete</button>
            </td>
          </tr>
          <tr>
            <td style="padding: 8px; border-bottom: 1px solid #ddd;">2</td>
            <td style="padding: 8px; border-bottom: 1px solid #ddd;">janedoe</td>
            <td style="padding: 8px; border-bottom: 1px solid #ddd;">jane@example.com</td>
            <td style="padding: 8px; border-bottom: 1px solid #ddd;">2023-05-22</td>
            <td style="padding: 8px; border-bottom: 1px solid #ddd;">
              <button style="background: #306748; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">Edit</button>
              <button style="background: #E39451; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">Delete</button>
            </td>
          </tr>
        </table>
      </div>
      
      <div id="online-content" class="tab-content">
        <h2>Online Users</h2>
        <p>Users currently connected to the platform.</p>
        <ul style="list-style-type: none; padding: 0;">
          <li style="padding: 8px; border-bottom: 1px solid #ddd; display: flex; align-items: center;">
            <div style="width: 30px; height: 30px; background: #306748; border-radius: 50%; margin-right: 10px;"></div>
            johndoe - Last active: Just now
          </li>
          <li style="padding: 8px; border-bottom: 1px solid #ddd; display: flex; align-items: center;">
            <div style="width: 30px; height: 30px; background: #306748; border-radius: 50%; margin-right: 10px;"></div>
            janedoe - Last active: 5 minutes ago
          </li>
        </ul>
      </div>
      
      <div id="friends-content" class="tab-content">
        <h2>Friend Connections</h2>
        <p>Monitor friend connections between users.</p>
      </div>
      
      <div id="groups-content" class="tab-content">
        <h2>Group Management</h2>
        <p>View and manage all group chats.</p>
      </div>
      
      <div id="messages-content" class="tab-content">
        <h2>Message Monitoring</h2>
        <p>View message statistics and flagged content.</p>
      </div>
      
      <div id="attachments-content" class="tab-content">
        <h2>File Attachments</h2>
        <p>Monitor and manage uploaded files.</p>
      </div>
      
      <div id="blocked-content" class="tab-content">
        <h2>Blocked Users</h2>
        <p>View and manage user blocks.</p>
      </div>
      
      <div id="general-content" class="tab-content">
        <h2>Dashboard Overview</h2>
        <p>Key platform statistics and metrics</p>
        
        <div style="display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 30px;">
          <div style="flex: 1; min-width: 200px; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h3 style="margin-top: 0;">Registered Users</h3>
            <div style="font-size: 32px; color: #306748; font-weight: bold;">{{ users_count }}</div>
          </div>
          <div style="flex: 1; min-width: 200px; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h3 style="margin-top: 0;">Total Messages</h3>
            <div style="font-size: 32px; color: #E39451; font-weight: bold;">{{ messages_count }}</div>
          </div>
          <div style="flex: 1; min-width: 200px; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h3 style="margin-top: 0;">Messages Today</h3>
            <div style="font-size: 32px; color: #7E453D; font-weight: bold;">{{ messages_today }}</div>
          </div>
          
          <div style="flex: 1; min-width: 200px; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h3 style="margin-top: 0;">Avg Messages per User</h3>
            <div style="font-size: 32px; color: #FDD367; font-weight: bold;">{{ avg_messages }}</div>
          </div>
          <div style="flex: 1; min-width: 200px; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h3 style="margin-top: 0;">Active Direct Chats</h3>
            <div style="font-size: 32px; color: #306748; font-weight: bold;">{{ direct_chats }}</div>
          </div>
          <div style="flex: 1; min-width: 200px; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h3 style="margin-top: 0;">Active Group Chats</h3>
            <div style="font-size: 32px; color: #E39451; font-weight: bold;">{{ group_chats }}</div>
          </div>
          
          <div style="flex: 1; min-width: 200px; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h3 style="margin-top: 0;">Online Users Now</h3>
            <div style="font-size: 32px; color: #5DA399; font-weight: bold;">{{ online_users }}</div>
            <div style="font-size: 14px; color: #666;">15% of total users</div>
          </div>
          <div style="flex: 1; min-width: 200px; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h3 style="margin-top: 0;">Storage Used</h3>
            <div style="font-size: 32px; color: #7E453D; font-weight: bold;">{{ storage_used }}</div>
          </div>
          <div style="flex: 1; min-width: 200px; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h3 style="margin-top: 0;">New Users Today</h3>
            <div style="font-size: 32px; color: #306748; font-weight: bold;">{{ new_users_today }}</div>
          </div>
        </div>
        
        <div style="display: flex; flex-wrap: wrap; gap: 20px;">
          <!-- User Activity Chart -->
          <div style="flex: 2; min-width: 400px; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h3>User Activity (Last 7 Days)</h3>
            <canvas id="userActivityChart" height="250"></canvas>
          </div>
          
          <!-- Message Distribution Chart -->
          <div style="flex: 1; min-width: 300px; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h3>Message Distribution</h3>
            <canvas id="messageDistributionChart" height="250"></canvas>
          </div>
        </div>
        
        <div style="margin-top: 20px; display: flex; flex-wrap: wrap; gap: 20px;">
          <!-- User Registrations Chart -->
          <div style="flex: 1; min-width: 400px; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h3>New User Registrations (2024)</h3>
            <canvas id="registrationsChart" height="100"></canvas>
          </div>
          
          <!-- Peak Hours Chart -->
          <div style="flex: 1; min-width: 400px; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h3>Message Activity by Hour</h3>
            <canvas id="peakHoursChart" height="100"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // Set default active tab
    document.addEventListener('DOMContentLoaded', function() {
      // Скрываем вкладки при загрузке, так как по умолчанию показываем General
      const tabsContainer = document.querySelector('.tabs-container');
      const tabDivider = document.querySelector('.tab-divider');
      tabsContainer.style.display = 'none';
      tabDivider.style.display = 'none';
      
      // Настраиваем отступ сверху для общего контента
      document.querySelectorAll('.tab-content').forEach(content => {
        content.style.marginTop = '20px'; 
      });
      
      // Активируем раздел General
      activateTabContent('general');
      document.querySelector('.general-button').classList.add('active');
      initCharts();
      
      // Exit button functionality
      document.getElementById('adminExitBtn').addEventListener('click', function() {
        window.location.href = '/mainWindow';
      });
      
      // Filter dropdown functionality
      const adminFilterButton = document.getElementById('adminFilterButton');
      const adminFilterDropdown = document.getElementById('adminFilterDropdown');
      const filterOptions = document.querySelectorAll('.filter-option');
      
      // Toggle dropdown when filter button is clicked
      if (adminFilterButton) {
        adminFilterButton.addEventListener('click', function(e) {
          e.stopPropagation();
          adminFilterDropdown.classList.toggle('show');
        });
      }
      
      // Close dropdown when clicking elsewhere
      document.addEventListener('click', function() {
        if (adminFilterDropdown) {
          adminFilterDropdown.classList.remove('show');
        }
      });
      
      // Handle filter option selection
      filterOptions.forEach(option => {
        option.addEventListener('click', function() {
          const filterType = this.getAttribute('data-filter');
          // Update button text
          adminFilterButton.textContent = this.textContent;
          // Close dropdown
          adminFilterDropdown.classList.remove('show');
          // Apply filter (implement search functionality here)
          console.log('Filter selected:', filterType);
        });
      });
    });
    
    // Function to switch between main sections (General, Users, Filter)
    function switchTab(section) {
      console.log('Switching to section:', section);
      
      // Remove active class from all nav buttons
      const navButtons = document.querySelectorAll('.nav-button');
      navButtons.forEach(button => button.classList.remove('active'));
      
      // Add active class to clicked button
      document.querySelector('.' + section + '-button').classList.add('active');
      
      // Получаем элементы, которые нужно настроить
      const tabsContainer = document.querySelector('.tabs-container');
      const tabDivider = document.querySelector('.tab-divider');
      const tabs = document.querySelectorAll('.tab');
      
      // Change content based on section
      if (section === 'general') {
        // В разделе General скрываем вкладки полностью
        tabsContainer.style.display = 'none';
        tabDivider.style.display = 'none';
        
        // Настраиваем основной блок контента чтобы не было большого отступа сверху
        document.querySelectorAll('.tab-content').forEach(content => {
          content.style.marginTop = '20px';
        });
        
        activateTabContent('general');
        initCharts();
      } else if (section === 'users') {
        // В разделе Users показываем вкладки как заголовки таблицы
        tabsContainer.style.display = 'flex'; 
        tabDivider.style.display = 'block';
        
        // Стилизуем вкладки как заголовки таблицы
        tabs.forEach(tab => {
          tab.style.background = '#e0e0e0';
          tab.style.padding = '10px 15px';
          tab.style.fontWeight = '500';
          tab.style.textAlign = 'center';
          tab.style.border = '1px solid #ccc';
        });
        
        // Возвращаем стандартный отступ сверху для контента
        document.querySelectorAll('.tab-content').forEach(content => {
          content.style.marginTop = '100px';
        });
        
        activateTabContent('users');
      } else if (section === 'filter') {
        // В разделе Filter также показываем вкладки
        tabsContainer.style.display = 'flex';
        tabDivider.style.display = 'block';
        
        // Возвращаем стандартный стиль вкладкам
        tabs.forEach(tab => {
          tab.style.background = '';
          tab.style.padding = '4px 12px';
          tab.style.fontWeight = '400';
          tab.style.textAlign = '';
          tab.style.border = 'none';
        });
        
        // Возвращаем стандартный отступ сверху для контента
        document.querySelectorAll('.tab-content').forEach(content => {
          content.style.marginTop = '100px';
        });
        
        activateTabContent('blocked');
      }
    }
    
    // Function to activate tab content
    function activateTabContent(tabId) {
      console.log('Activating tab content:', tabId);
      
      // Hide all tab content
      const tabContents = document.querySelectorAll('.tab-content');
      tabContents.forEach(content => content.classList.remove('active'));
      
      // Show selected tab content
      const selectedContent = document.getElementById(tabId + '-content');
      if (selectedContent) {
        selectedContent.classList.add('active');
      }
      
      // Update tabs UI
      const tabs = document.querySelectorAll('.tab');
      tabs.forEach(tab => {
        if (tab.getAttribute('data-tab') === tabId) {
          tab.classList.add('active');
        } else {
          tab.classList.remove('active');
        }
      });
    }
    
    // Добавить новую функцию initCharts
    function initCharts() {


      // User Activity Chart
      const activityCtx = document.getElementById('userActivityChart').getContext('2d');
      const activityChart = new Chart(activityCtx, {
        type: 'line',
        data: {
          labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
          datasets: [{
            label: 'Active Users',
            data: userActivityData,
            borderColor: '#306748',
            backgroundColor: 'rgba(48, 103, 72, 0.1)',
            fill: true,
            tension: 0.3
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'top',
            }
          }
        }
      });
    
      // Message Distribution Chart
      const distributionCtx = document.getElementById('messageDistributionChart').getContext('2d');
      const distributionChart = new Chart(distributionCtx, {
        type: 'pie',
        data: {
          labels: ['Direct Messages', 'Group Messages'],
          datasets: [{
            data: messageDistributionData,
            backgroundColor: ['#E39451', '#306748']
          }]
        },
        options: {
          responsive: true
        }
      });
    
      // Registration Chart
      const registrationsCtx = document.getElementById('registrationsChart').getContext('2d');
      const registrationsChart = new Chart(registrationsCtx, {
        type: 'bar',
        data: {
          labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May'],
          datasets: [{
            label: 'New Users',
            data: registrationsData,
            backgroundColor: '#FDD367'
          }]
        },
        options: {
          responsive: true
        }
      });
    
      // Peak Hours Chart
      const peakHoursCtx = document.getElementById('peakHoursChart').getContext('2d');
      const peakHoursChart = new Chart(peakHoursCtx, {
        type: 'bar',
        data: {
          labels: ['00:00', '03:00', '06:00', '09:00', '12:00', '15:00', '18:00', '21:00'],
          datasets: [{
            label: 'Messages',
            data: peakHoursData,
            backgroundColor: '#5DA399'
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              display: false
            }
          }
        }
      });
    }
  </script>
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    const exitBtn = document.getElementById('adminExitBtn');
    if (exitBtn) {
      exitBtn.onclick = function() {
        window.location.href = '/mainWindow';
      };
    }
    // ...остальной ваш код...
  });
</script>
</body>
</html>