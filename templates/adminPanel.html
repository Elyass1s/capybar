<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - Capybara Messenger</title>
  <link href="https://fonts.googleapis.com/css2?family=Konkhmer+Sleokchher&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Roboto', sans-serif;
      background-color: #306748;
      overflow: hidden;
    }
    
    .container {
      width: 1440px;
      height: 1024px;
      position: relative;
      margin: 0 auto;
      background: #306748;
      overflow: hidden;
    }
    
    .nav-button {
      width: 344px;
      height: 85px;
      background: #E39451;
      border-radius: 35px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    
    .nav-button:hover {
      background: #f0a05a;
    }
    
    .nav-button-text {
      color: white;
      font-size: 48px;
      font-family: 'Konkhmer Sleokchher', cursive;
      font-weight: 400;
      text-align: center;
    }
    
    .general-button {
      left: 38px;
      top: 127px;
      position: absolute;
    }
    
    .users-button {
      left: 38px;
      top: 234px;
      position: absolute;
    }
    
    .filter-button {
      left: 38px;
      top: 341px;
      position: absolute;
    }
    
    .exit-button {
      width: 228px;
      height: 85px;
      left: 38px;
      top: 908px;
      position: absolute;
      background: #E39451;
      border-radius: 35px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.3s;
    }
    
    .exit-button:hover {
      background: #f0a05a;
    }
    
    .exit-text {
      width: 100%;
      height: 70px;
      color: white;
      font-size: 48px;
      font-family: 'Konkhmer Sleokchher', cursive;
      font-weight: 400;
      text-align: center;
      line-height: 85px;
    }
    
    .content-area {
      width: 1011px;
      height: 700px;
      left: 414px;
      top: 127px;
      position: absolute;
      background: #F0FAEF;
      border-radius: 70px;
      overflow: hidden;
    }
    
    .title {
      width: 455px;
      height: 112px;
      left: 28px;
      top: 12px;
      position: absolute;
      text-align: center;
      color: white;
      font-size: 48px;
      font-family: 'Konkhmer Sleokchher', cursive;
      font-weight: 400;
    }
    
    .profile-pic {
      width: 80px;
      height: 80px;
      left: 10px;
      top: 12px;
      position: absolute;
      border-radius: 172px;
      object-fit: cover;
    }
    
    .tabs-container {
      width: 100%;
      height: 55px;
      position: absolute;
      top: 23px;
      display: flex;
      justify-content: space-around;
    }
    
    .tab-divider {
      width: 1011px;
      height: 1px;
      left: 0;
      top: 95px;
      position: absolute;
      background: black;
    }
    
    .tab {
      color: black;
      font-size: 16px;
      font-family: 'Roboto', sans-serif;
      font-weight: 400;
      line-height: 24px;
      letter-spacing: 0.5px;
      cursor: pointer;
      padding: 4px 12px;
      transition: all 0.3s;
    }
    
    .tab:hover {
      background-color: rgba(0,0,0,0.05);
      border-radius: 4px;
    }
    
    .tab.active {
      font-weight: 500;
      color: #306748;
      border-bottom: 2px solid #306748;
    }
    
    .tab-content {
      display: none;
      padding: 20px;
      margin-top: 100px;
      height: calc(100% - 140px);
      overflow-y: auto;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* Add these new styles for search bar */
    .admin-search-container {
      width: 800px;
      /* height: 60px; */
      position: absolute;
      left: 500px; /* Совпадает с left у content-area */
      top: 30px; /* Немного выше content-area */
      display: flex;
      align-items: center; /* Убираем justify-content: center */
      z-index: 10;
    }
    
    .admin-search-bar {
      width: 970px; /* Увеличиваем с 400px до почти ширины контейнера */
      height: 60px;
      background-color: #FDD367;
      border-radius: 25px;
      color: #7E453D;
      font-size: 32px;
      font-weight: 400;
      border: none;
      padding: 0 20px;
      text-align: center;
      font-family: 'Konkhmer Sleokchher', cursive;
      outline: none;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .admin-search-bar::placeholder {
      color: #7E453D;
    }
    
    .filter-dropdown {
      position: relative;
    }
    
    .admin-filter-button {
      width: 200px;
      height: 60px;
      background-color: #FDD367;
      border-radius: 25px;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #7E453D;
      font-size: 26px;
      font-weight: 400;
      border: none;
      font-family: 'Konkhmer Sleokchher', cursive;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .filter-dropdown-content {
      display: none;
      position: absolute;
      background-color: white;
      min-width: 200px;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
      z-index: 1;
      border-radius: 15px;
      overflow: hidden;
    }
    
    .filter-dropdown-content.show {
      display: block;
    }
    
    .filter-option {
      color: #306748;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
      cursor: pointer;
      font-family: 'Konkhmer Sleokchher', cursive;
      font-size: 18px;
      border: none;
      background: white;
      width: 100%;
      text-align: left;
    }
    
    .filter-option:hover {
      background-color: #f1f1f1;
    }

    .status-indicator.online { color: green; }
    .status-indicator.offline { color: grey; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="container">
    <!-- Header and profile -->
    <div class="title">Admin panel</div>
    <img class="profile-pic" src="/static/img/image 86.png" alt="Profile" />
    
    <!-- Add search bar above content-area -->
    <div class="admin-search-container">
      <input type="text" class="admin-search-bar" placeholder="Search">
    </div>
    
    <!-- Navigation buttons -->
    <div class="nav-button general-button" onclick="switchTab('general')">
      <div class="nav-button-text">General</div>
    </div>
    
    <div class="nav-button users-button" onclick="switchTab('users')">
      <div class="nav-button-text">Users</div>
    </div>
    
    <div class="nav-button filter-button" onclick="switchTab('filter')">
      <div class="nav-button-text">Filter</div>
    </div>
    
    <!-- Exit button -->
    <button class="exit-btn" id="adminExitBtn"
    style="width: 344px; height: 85px; left: 38px; top: 447px; position: absolute;
    background: #E39451; border-radius: 35px; border: none; color: white; font-size: 48px;
    font-family: 'Konkhmer Sleokchher', cursive; font-weight: 400; text-align: center;
    padding-left: 0; cursor: pointer; z-index: 10;
    transition: transform 0.15s cubic-bezier(.4,0,.2,1), box-shadow 0.15s;">
  Exit
</button>
    
    <!-- Main content area -->
    <div class="content-area">
      <!-- Tabs -->
      <div class="tabs-container">
        <div class="tab" data-tab="users" onclick="activateTabContent('users')">USERS</div>
        <div class="tab" data-tab="online" onclick="activateTabContent('online')">ONLINE</div>
        <div class="tab" data-tab="friends" onclick="activateTabContent('friends')">FRIENDS</div>
        <div class="tab" data-tab="groups" onclick="activateTabContent('groups')">GROUPS</div>
        <div class="tab" data-tab="messages" onclick="activateTabContent('messages')">MESSAGES</div>
        <div class="tab" data-tab="attachments" onclick="activateTabContent('attachments')">ATTACHMENTS</div>
        <div class="tab" data-tab="blocked" onclick="activateTabContent('blocked')">BLOCKED USERS</div>
      </div>
      
      <div class="tab-divider"></div>
      
      <!-- Tab content areas -->
      <div id="users-content" class="tab-content">
        <h2>Users Management</h2>
        <p>View and manage all registered users.</p>
        <div style="overflow-x: auto;">
          <table style="width:100%; border-collapse: collapse; min-width: 900px;">
            <tr style="background-color: #e0e0e0;">
              <th style="padding: 8px; text-align: left;">User ID</th>
              <th style="padding: 8px; text-align: left;">Username</th>
              <th style="padding: 8px; text-align: left;">Email</th>
              <th style="padding: 8px; text-align: left;">Online Status</th>
              <th style="padding: 8px; text-align: left;">Friends</th>
              <th style="padding: 8px; text-align: left;">Groups</th>
              <th style="padding: 8px; text-align: left;">Messages</th>
              <th style="padding: 8px; text-align: left;">Attachments</th>
              <th style="padding: 8px; text-align: left;">Blocked</th>
              <th style="padding: 8px; text-align: left;">Actions</th>
            </tr>
            {% for user in users_data %}
            <tr>
              <td style="padding: 8px; border-bottom: 1px solid #ddd;">{{ user.id }}</td>
              <td style="padding: 8px; border-bottom: 1px solid #ddd;">{{ user.name }}</td>
              <td style="padding: 8px; border-bottom: 1px solid #ddd;">{{ user.email }}</td>
              <td style="padding: 8px; border-bottom: 1px solid #ddd;">
                <span class="status-indicator {{ 'online' if user.is_online else 'offline' }}">
                  {{ 'Online' if user.is_online else 'Offline' }}
                </span>
              </td>
              <td style="padding: 8px; border-bottom: 1px solid #ddd;">{{ user.friends_count }}</td>
              <td style="padding: 8px; border-bottom: 1px solid #ddd;">{{ user.groups_count }}</td>
              <td style="padding: 8px; border-bottom: 1px solid #ddd;">{{ user.messages_count }}</td>
              <td style="padding: 8px; border-bottom: 1px solid #ddd;">{{ user.attachments_count }}</td>
              <td style="padding: 8px; border-bottom: 1px solid #ddd;">{{ user.blocked_count }}</td>
              <td style="padding: 8px; border-bottom: 1px solid #ddd;">
                <button data-userid="{{ user.id }}" onclick="showUserDetails(this.getAttribute('data-userid'))" style="background: #306748; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">More</button>
                <button style="background: #E39451; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">Delete</button>
              </td>
            </tr>
            {% endfor %}
            {% if not users_data %}
            <tr>
              <td colspan="10" style="padding: 20px; text-align: center;">Пользователей не найдено</td>
            </tr>
            {% endif %}
          </table>
        </div>
      </div>
      
      <div id="online-content" class="tab-content">
        <h2>Online Users</h2>
        <p>Users currently connected to the platform.</p>
        <ul style="list-style-type: none; padding: 0;">
          <li style="padding: 8px; border-bottom: 1px solid #ddd; display: flex; align-items: center;">
            <div style="width: 30px; height: 30px; background: #306748; border-radius: 50%; margin-right: 10px;"></div>
            johndoe - Last active: Just now
          </li>
          <li style="padding: 8px; border-bottom: 1px solid #ddd; display: flex; align-items: center;">
            <div style="width: 30px; height: 30px; background: #306748; border-radius: 50%; margin-right: 10px;"></div>
            janedoe - Last active: 5 minutes ago
          </li>
        </ul>
      </div>
      
      <div id="friends-content" class="tab-content">
        <h2>Friend Connections</h2>
        <p>Monitor friend connections between users.</p>
      </div>
      
      <div id="groups-content" class="tab-content">
        <h2>Group Management</h2>
        <p>View and manage all group chats.</p>
      </div>
      
      <div id="messages-content" class="tab-content">
        <h2>Message Monitoring</h2>
        <p>View message statistics and flagged content.</p>
      </div>
      
      <div id="attachments-content" class="tab-content">
        <h2>File Attachments</h2>
        <p>Monitor and manage uploaded files.</p>
      </div>
      
      <div id="blocked-content" class="tab-content">
        <h2>Blocked Users</h2>
        <p>View and manage user blocks.</p>
      </div>
      
      <div id="general-content" class="tab-content">
        <h2>Dashboard Overview</h2>
        <p>Key platform statistics and metrics</p>
        
        <div style="display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 30px;">
          <div style="flex: 1; min-width: 200px; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h3 style="margin-top: 0;">Registered Users</h3>
            <div style="font-size: 32px; color: #306748; font-weight: bold;">{{ users_count }}</div>
          </div>
          <div style="flex: 1; min-width: 200px; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h3 style="margin-top: 0;">Total Messages</h3>
            <div style="font-size: 32px; color: #E39451; font-weight: bold;">{{ messages_count }}</div>
          </div>
          <div style="flex: 1; min-width: 200px; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h3 style="margin-top: 0;">Messages Today</h3>
            <div style="font-size: 32px; color: #7E453D; font-weight: bold;">{{ messages_today }}</div>
          </div>
          
          <div style="flex: 1; min-width: 200px; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h3 style="margin-top: 0;">Avg Messages per User</h3>
            <div style="font-size: 32px; color: #FDD367; font-weight: bold;">{{ avg_messages }}</div>
          </div>
          <div style="flex: 1; min-width: 200px; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h3 style="margin-top: 0;">Active Direct Chats</h3>
            <div style="font-size: 32px; color: #306748; font-weight: bold;">{{ direct_chats }}</div>
          </div>
          <div style="flex: 1; min-width: 200px; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h3 style="margin-top: 0;">Active Group Chats</h3>
            <div style="font-size: 32px; color: #E39451; font-weight: bold;">{{ group_chats }}</div>
          </div>
          
          <div style="flex: 1; min-width: 200px; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h3 style="margin-top: 0;">Online Users Now</h3>
            <div style="font-size: 32px; color: #5DA399; font-weight: bold;">{{ online_users }}</div>
            <div style="font-size: 14px; color: #666;">{{ online_percentage }}% от всех пользователей</div>
          </div>
          <div style="flex: 1; min-width: 200px; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h3 style="margin-top: 0;">Storage Used</h3>
            <div style="font-size: 32px; color: #7E453D; font-weight: bold;">{{ storage_used }}</div>
          </div>
          <div style="flex: 1; min-width: 200px; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h3 style="margin-top: 0;">New Users Today</h3>
            <div style="font-size: 32px; color: #306748; font-weight: bold;">{{ new_users_today }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Модальное окно для детальной информации о пользователе -->
  <div id="userDetailsModal" class="modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4);">
    <div class="modal-content" style="background-color: #1f1f1f; margin: 5% auto; padding: 20px; border-radius: 10px; width: 80%; max-width: 700px; color: #fff; position: relative;">
      <span class="close-button" onclick="closeUserModal()" style="position: absolute; right: 20px; top: 10px; font-size: 28px; font-weight: bold; cursor: pointer;">&times;</span>
      
      <h2 id="modal-username" style="color: #E39451; margin-bottom: 20px;"></h2>
      
      <div class="user-details-container" style="display: flex; flex-wrap: wrap; gap: 20px;">
        <!-- Левая колонка - аватар и основная информация -->
        <div class="left-column" style="flex: 1; min-width: 250px;">
          <div class="avatar-container" style="text-align: center; margin-bottom: 20px;">
            <img id="user-avatar" src="" alt="User Avatar" style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 3px solid #306748;">
          </div>
          
          <div class="status-indicator" style="text-align: center; margin-bottom: 20px;">
            <span id="online-status" style="padding: 5px 10px; border-radius: 20px; font-size: 14px;"></span>
          </div>
        </div>
        
        <!-- Правая колонка - детальная информация -->
        <div class="right-column" style="flex: 2; min-width: 300px;">
          <div class="info-field" style="margin-bottom: 15px;">
            <div class="field-label" style="color: #999; font-size: 14px;">Email</div>
            <div id="user-email" class="field-value" style="font-size: 16px;"></div>
          </div>
          
          <div class="info-field" style="margin-bottom: 15px;">
            <div class="field-label" style="color: #999; font-size: 14px;">Nickname</div>
            <div id="user-nickname" class="field-value" style="font-size: 16px;"></div>
          </div>
          
          <div class="info-field" style="margin-bottom: 15px;">
            <div class="field-label" style="color: #999; font-size: 14px;">Date of Birth</div>
            <div id="user-birthdate" class="field-value" style="font-size: 16px;"></div>
          </div>
          
          <div class="info-field" style="margin-bottom: 15px;">
            <div class="field-label" style="color: #999; font-size: 14px;">Status</div>
            <div id="user-status" class="field-value" style="font-size: 16px;"></div>
          </div>
          
          <div class="info-field" style="margin-bottom: 15px;">
            <div class="field-label" style="color: #999; font-size: 14px;">Last Active</div>
            <div id="user-last-active" class="field-value" style="font-size: 16px;"></div>
          </div>
          
          <div class="info-field" style="margin-bottom: 15px;">
            <div class="field-label" style="color: #999; font-size: 14px;">Registered On</div>
            <div id="user-created" class="field-value" style="font-size: 16px;"></div>
          </div>
        </div>
      </div>
      
      <!-- Статистика пользователя -->
      <div class="user-stats" style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #444;">
        <h3 style="color: #E39451; margin-bottom: 15px;">User Statistics</h3>
        
        <div style="display: flex; flex-wrap: wrap; gap: 15px;">
          <div class="stat-box" style="flex: 1; min-width: 120px; background-color: #306748; padding: 15px; border-radius: 8px; text-align: center;">
            <div class="stat-value" id="stat-friends" style="font-size: 24px; font-weight: bold;"></div>
            <div class="stat-label" style="font-size: 14px;">Friends</div>
          </div>
          
          <div class="stat-box" style="flex: 1; min-width: 120px; background-color: #306748; padding: 15px; border-radius: 8px; text-align: center;">
            <div class="stat-value" id="stat-groups" style="font-size: 24px; font-weight: bold;"></div>
            <div class="stat-label" style="font-size: 14px;">Groups</div>
          </div>
          
          <div class="stat-box" style="flex: 1; min-width: 120px; background-color: #306748; padding: 15px; border-radius: 8px; text-align: center;">
            <div class="stat-value" id="stat-messages" style="font-size: 24px; font-weight: bold;"></div>
            <div class="stat-label" style="font-size: 14px;">Messages</div>
          </div>
          
          <div class="stat-box" style="flex: 1; min-width: 120px; background-color: #306748; padding: 15px; border-radius: 8px; text-align: center;">
            <div class="stat-value" id="stat-attachments" style="font-size: 24px; font-weight: bold;"></div>
            <div class="stat-label" style="font-size: 14px;">Attachments</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // Set default active tab
    document.addEventListener('DOMContentLoaded', function() {
      // Скрываем вкладки при загрузке, так как по умолчанию показываем General
      const tabsContainer = document.querySelector('.tabs-container');
      const tabDivider = document.querySelector('.tab-divider');
      tabsContainer.style.display = 'none';
      tabDivider.style.display = 'none';
      
      // Настраиваем отступ сверху для общего контента
      document.querySelectorAll('.tab-content').forEach(content => {
        content.style.marginTop = '20px'; 
      });
      
      // Активируем раздел General
      activateTabContent('general');
      document.querySelector('.general-button').classList.add('active');
      initCharts();
      
      // Exit button functionality
      document.getElementById('adminExitBtn').addEventListener('click', function() {
        window.location.href = '/mainWindow';
      });
      
      // Filter dropdown functionality
      const adminFilterButton = document.getElementById('adminFilterButton');
      const adminFilterDropdown = document.getElementById('adminFilterDropdown');
      const filterOptions = document.querySelectorAll('.filter-option');
      
      // Toggle dropdown when filter button is clicked
      if (adminFilterButton) {
        adminFilterButton.addEventListener('click', function(e) {
          e.stopPropagation();
          adminFilterDropdown.classList.toggle('show');
        });
      }
      
      // Close dropdown when clicking elsewhere
      document.addEventListener('click', function() {
        if (adminFilterDropdown) {
          adminFilterDropdown.classList.remove('show');
        }
      });
      
      // Handle filter option selection
      filterOptions.forEach(option => {
        option.addEventListener('click', function() {
          const filterType = this.getAttribute('data-filter');
          // Update button text
          adminFilterButton.textContent = this.textContent;
          // Close dropdown
          adminFilterDropdown.classList.remove('show');
          // Apply filter (implement search functionality here)
          console.log('Filter selected:', filterType);
        });
      });
    });
    
    // Function to switch between main sections (General, Users, Filter)
    function switchTab(section) {
      console.log('Switching to section:', section);
      
      // Remove active class from all nav buttons
      const navButtons = document.querySelectorAll('.nav-button');
      navButtons.forEach(button => button.classList.remove('active'));
      
      // Add active class to clicked button
      document.querySelector('.' + section + '-button').classList.add('active');
      
      // Получаем элементы, которые нужно настроить
      const tabsContainer = document.querySelector('.tabs-container');
      const tabDivider = document.querySelector('.tab-divider');
      
      // Change content based on section
      if (section === 'general') {
        // В разделе General скрываем вкладки полностью
        tabsContainer.style.display = 'none';
        tabDivider.style.display = 'none';
        
        // Настраиваем основной блок контента чтобы не было большого отступа сверху
        document.querySelectorAll('.tab-content').forEach(content => {
          content.style.marginTop = '20px';
        });
        
        activateTabContent('general');
        initCharts();
      } else if (section === 'users') {
        // В разделе Users скрываем вкладки, показываем только таблицу пользователей
        tabsContainer.style.display = 'none'; 
        tabDivider.style.display = 'none';
        
        // Настраиваем отступ сверху для контента пользователей
        document.querySelectorAll('.tab-content').forEach(content => {
          content.style.marginTop = '20px';
        });
        
        activateTabContent('users');
      } else if (section === 'filter') {
        // В разделе Filter показываем вкладки
        tabsContainer.style.display = 'flex';
        tabDivider.style.display = 'block';
        
        // Возвращаем стандартный отступ сверху для контента
        document.querySelectorAll('.tab-content').forEach(content => {
          content.style.marginTop = '100px';
        });
        
        activateTabContent('blocked');
      }
    }
    
    // Function to activate tab content
    function activateTabContent(tabId) {
      console.log('Activating tab content:', tabId);
      
      // Hide all tab content
      const tabContents = document.querySelectorAll('.tab-content');
      tabContents.forEach(content => content.classList.remove('active'));
      
      // Show selected tab content
      const selectedContent = document.getElementById(tabId + '-content');
      if (selectedContent) {
        selectedContent.classList.add('active');
      }
      
      // Update tabs UI
      const tabs = document.querySelectorAll('.tab');
      tabs.forEach(tab => {
        if (tab.getAttribute('data-tab') === tabId) {
          tab.classList.add('active');
        } else {
          tab.classList.remove('active');
        }
      });
    }
    
    // Добавить новую функцию initCharts
    function initCharts() {
    }
  </script>
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    const exitBtn = document.getElementById('adminExitBtn');
    if (exitBtn) {
      exitBtn.onclick = function() {
        window.location.href = '/mainWindow';
      };
    }
    // ...остальной ваш код...
  });
</script>
<script>
  // Функция для отображения информации о пользователе
  function showUserDetails(userId) {
    fetch(`/get_user_details/${userId}`)
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          const user = data.user;
          
          // Заполняем данные в модальном окне
          document.getElementById('modal-username').textContent = user.name;
          
          // Аватар пользователя - ИСПРАВЛЕНО
          const avatarEl = document.getElementById('user-avatar');
          if (user.avatar) {
            avatarEl.src = `/static/uploads/${user.avatar}`;
          } else {
            avatarEl.src = '/static/img/image 86.png';  // Изменено на нужное изображение по умолчанию
          }
          
          // Статус онлайн
          const statusEl = document.getElementById('online-status');
          if (user.is_online) {
            statusEl.textContent = 'Online';
            statusEl.style.backgroundColor = '#4CAF50';
          } else {
            statusEl.textContent = 'Offline';
            statusEl.style.backgroundColor = '#F44336';
          }
          
          // Основная информация
          document.getElementById('user-email').textContent = user.email;
          document.getElementById('user-nickname').textContent = user.nickname || 'Not set';
          document.getElementById('user-birthdate').textContent = user.birthdate || 'Not set';
          document.getElementById('user-status').textContent = user.status || 'No status';
          
          // Форматирование дат
          const formatDate = (dateStr) => {
            if (!dateStr) return 'Never';
            const date = new Date(dateStr);
            return date.toLocaleString();
          };
          
          document.getElementById('user-last-active').textContent = formatDate(user.last_active);
          document.getElementById('user-created').textContent = formatDate(user.created_at);
          
          // Статистика
          document.getElementById('stat-friends').textContent = user.friends_count;
          document.getElementById('stat-groups').textContent = user.groups_count;
          document.getElementById('stat-messages').textContent = user.messages_count;
          document.getElementById('stat-attachments').textContent = user.attachments_count;
          
          // Показываем модальное окно
          document.getElementById('userDetailsModal').style.display = 'block';
        } else {
          alert('Error loading user data: ' + data.message);
        }
      })
      .catch(error => {
        console.error('Error fetching user details:', error);
        alert('Error fetching user details. Please try again.');
      });
  }
  
  // Функция для закрытия модального окна
  function closeUserModal() {
    document.getElementById('userDetailsModal').style.display = 'none';
  }
  
  // Закрытие модального окна при клике вне его содержимого
  window.onclick = function(event) {
    const modal = document.getElementById('userDetailsModal');
    if (event.target == modal) {
      modal.style.display = 'none';
    }
  }
</script>
</body>
</html>